---
title: "Targets documentation for TOPFUN project"
output: html_document
---

Initialize the list of targets.

```{r setup}
knitr::opts_chunk$set(echo = TRUE)

require(targets)
require(here)

targets <- list()
```

## Compile targets documentation

This chunk renders the documented list of targets into html file and saves it to the `docs` folder. As the `docs` folder is meant to contain documents generated by the code, its content is git-ignored.

```{r tar_documentation}

targets$documentation <- list(
    
    tar_target(
        tar_plan_file,
        here("tar_plan.Rmd"),
        format = "file"
        ),

    tar_target(
        tar_documentation,
        rmarkdown::render(tar_plan_file,
                          output_file = here("docs", "plan_documentation.html"))
        )
)

```

## Import of raw data 

Download raw data content to the `data_raw` directory from URL.

Load the data as a target to be used in the pipeline.

```{r data_import}

targets$data_import <- list(
    
    # Download data
    
    # tar_cue(mode = "never") means the target runs only when the targets cache is empty
    # download_data() checks if file exists in the location and skips the download
    # if that is the case. This means that for a full refresh of the project,  
    # data should be manually removed from the raw_data folder and the target should be
    # invalidate with targets::tar_invalidate(data_csf_download)

    
    tar_target(
        data_csf_download,
        download_data(
            url = "https://owncloud.cesnet.cz/index.php/s/HIm7FEYQIMfoBuu/download",
            data_file = here("data", "data_raw", "czech_science_foundation.tsv")
            ),
        format = "file",
        cue = tar_cue(mode = "never")
    ),
   

    # Read the data as targets

    tar_target(
        data_csf,
        read_tsv(data_csf_download,
                 show_col_types = FALSE),
        format = "qs"
    )
)


```
