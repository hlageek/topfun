---
title: "Main TOPFUN pipeline"
format:
  html:
    code-fold: true
    number-sections: true
---

# Data {#sec-data}

- __Requirements__: 
  - Set `API_RUN=TRUE` in `.Renviron`.

This section is intended for obtaining data, processing data, and producing topic models. All relevant outputs get exported into their respective pinboards. [Code in this section needs to be run only by the project administrators.]{style="color: red"}

## Get raw data {#sec-data_get}

### Czech data (`data_czech` subproject)

### French data (`data_french` subproject)

### Swiss data (`data_swiss` subproject)

### EU data (`data_eu` subproject)



```{r}
#| label: data_getport 
#| eval: false
start <- Sys.time()
quarto::quarto_render("_external.qmd", quiet = TRUE)
targets::tar_make(script = "_external.R", store = "_external")
Sys.time()-start
```

## Process data  (`data_process` subproject) {#sec-data_process}


- __Requirements__: 
  - @sec-data_get must be completed.
  

This code needs to be run only if data sources change and need to be updated. You should only compile this subproject if you know what you are doing and why you are doing it.



```{r}
#| label: data_export
#| eval: false
quarto::quarto_render("_data_raw.qmd", quiet = TRUE)
targets::tar_make(script = "_data_raw.R", store = "_data_raw")
```
## Produce topic model  (`data_topmodel` subproject) {#sec-data_topmodel}

- __Requirements__: 
  - @sec-data_process must be completed.


## Export pins  (`data_export` subproject)

- __Requirements__: 
  -  @sec-data_get must be completed.
  -  @sec-data_process must be completed.
  -  @sec-data_topmodel must be completed.
  - Set `PINS_BOARD=PATH_TO_PINBOARD` in `.Renviron`.

This code needs to be run only if data sources change and need to be updated. In principle, this is not required except when initializing the project. 


# Analysis (`_targets`  default)

Code in this section should be run by all collaborators, on all machines. It is connected to the previous section only by dependency on the generated pins.

## (Re)Import pins (`data_import` subproject) {#sec-data_import}

Here we reimport data processed and produced in @sec-data

- __Requirements__:
  -  Set `MANIFEST_URL=URL/_pins.yaml` in `.Renviron`. 
  - internet connection.

```{r}
#| label: data_import
#| eval: false
quarto::quarto_render("_data_import.qmd", quiet = TRUE)
targets::tar_make(script = "_data_import.R", store = "_data_import")
```

## Analyze data (`data_analyze` subproject)

- __Requirements__: 
  -  @sec-data_import must be completed

```{r}
#| label: quarto-projects
#| eval: false
quarto::quarto_render("_data_analyze.qmd", quiet = TRUE)
targets::tar_make(script = "_data_analyze.R", store = "_data_analyze")
```

This is the default pipeline. It serves for analysis of the raw data stored in the pinboard. 

## Report results

